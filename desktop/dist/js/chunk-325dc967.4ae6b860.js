(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-325dc967"],{1458:function(t,e,a){},"4dc6":function(t,e,a){"use strict";var o=a("b374");e["a"]=o["a"]},5959:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"mainContent"},[a("div",{staticClass:"head"},[a("span",{staticStyle:{"font-size":"22px",color:"#FFF"}},[t._v("空间总览")]),a("div",{staticClass:"attach"},[a("Select",{attrs:{size:"small"},on:{"on-change":t.changeColor},model:{value:t.countType,callback:function(e){t.countType=e},expression:"countType"}},[a("Option",{attrs:{value:"0"}},[t._v("按部门统计")]),a("Option",{attrs:{value:"1"}},[t._v("按用途统计")])],1)],1)]),a("div",{staticClass:"body"},[a("div",{staticClass:"blockTitle"},[t._v(" 房间统计 ")]),a("div",{staticClass:"info"},[a("div",{staticClass:"roomInfo"},[a("div",{staticClass:"baseInfo"},[a("div",[t._v("房间数")]),a("div",[a("span",{staticStyle:{"font-size":"20px"}},[t._v(t._s(t.roomCount))]),t._v(" 个")])])]),a("div",{staticClass:"roomInfo"},[a("div",{staticClass:"baseInfo"},[a("div",[t._v("使用部门")]),a("div",[a("span",{staticStyle:{"font-size":"20px"}},[t._v(t._s(t.departmentCount))]),t._v(" 个")])])]),a("div",{staticClass:"roomInfo"},[a("div",{staticClass:"baseInfo"},[a("div",[t._v("用途种类")]),a("div",{staticStyle:{"font-size":"20px"}},[t._v(t._s(t.usageCount)+" 个")])])]),a("div",{staticClass:"roomInfo"},[a("div",{staticClass:"baseInfo",staticStyle:{cursor:"pointer"},on:{click:function(e){t.showDetail=!t.showDetail}}},[t._v(" "+t._s(t.showDetail?"显示总览":"显示详情")+" ")])])]),a("div",{staticClass:"table",class:{roomDetail:t.showDetail}},[t.showDetail?[t.roomLoading?a("Loading"):[a("table",[a("thead",[a("tr",[a("th",[t._v("房间号")]),a("th",[t._v("房间名称")]),a("th",[t._v("部门")]),a("th",[t._v("用途")]),a("th",[t._v("使用状态")]),a("th",[t._v("使用面积（㎡）")])])])]),a("div",{staticClass:"tableDetail"},[a("table",t._l(t.roomDetail,(function(e){return a("tr",{key:e.id},[a("td",[t._v(t._s(e.number))]),a("td",[t._v(t._s(e.name))]),a("td",[t._v(t._s(e.department_name))]),a("td",[t._v(t._s(e.category_name))]),a("td",[t._v(t._s(e.department_name?"使用中":"未使用"))]),a("td",[t._v(t._s(e.NetArea))])])})),0)]),a("Page",{staticStyle:{"text-align":"right"},attrs:{current:t.tableCurrent,total:t.total,"show-total":"",simple:"",size:"small"},on:{"update:current":function(e){t.tableCurrent=e},"on-change":t.pageChange}})]]:[t._m(0),a("div",{staticClass:"tableDetail"},[a("table",t._l(t.tableValue,(function(e){return a("tr",{key:e.name},[a("td",[t._v(t._s(e.name))]),a("td",[t._v(t._s(e.count))]),a("td",[t._v(t._s(e.areaUse))]),a("td",[t._v(t._s(e.buildUse))])])})),0)])]],2),a("div",{staticClass:"blockTitle"},[t._v(" 运维统计 ")]),a("div",{staticClass:"info"},[a("div",{staticClass:"roomInfo"},[a("div",{staticClass:"baseInfo widthAttach"},[a("div",[t._v(t._s(t.repairRoom))]),a("div",{staticStyle:{"border-left":"1px solid #FFF","margin-left":"6px","padding-left":"6px"}},[t._v("异常率 "+t._s(t._f("getPresent")(t.repairRoom,t.roomCount))+"% ")])]),a("div",{staticClass:"attach"},[t._v(" 报修房间 ")])]),a("div",{staticClass:"roomInfo"},[a("div",{staticClass:"baseInfo widthAttach"},[a("div",[t._v(t._s(t.maintenanceCount))]),a("div",{staticStyle:{"border-left":"1px solid #FFF","margin-left":"6px","padding-left":"6px"}},[t._v("异常率 "+t._s(t._f("getPresent")(t.maintenanceCount,t.roomCount))+"% ")])]),a("div",{staticClass:"attach"},[t._v(" 维保房间 ")])]),a("div",{staticClass:"roomInfo"},[a("div",{staticClass:"baseInfo widthAttach"},[a("div",[t._v(t._s(t.unusedRoomCount))]),a("div",{staticStyle:{"border-left":"1px solid #FFF","margin-left":"6px","padding-left":"6px"}},[t._v("闲置率 "+t._s(t._f("getPresent")(t.unusedRoomCount,t.roomCount))+"% ")])]),a("div",{staticClass:"attach"},[t._v(" 闲置房间 ")])])]),a("div",{staticClass:"blockTitle"},[t._v(" 房间面积统计 ")]),t._m(1),a("div",{staticClass:"charts"},[a("div",{staticClass:"chart",attrs:{id:t.chartIdA}}),a("div",{staticClass:"chart",attrs:{id:t.chartIdB}})])])]),a("FloorSelector",{staticStyle:{position:"absolute",left:"80px",bottom:"20px","pointer-events":"all"},attrs:{dataset:t.floors}}),a("div",{staticClass:"legends"},t._l(t.currentLegend,(function(e){return a("div",{key:e.name,staticClass:"legend"},[a("code",{style:{color:e.color}},[t._v("■")]),a("span",[t._v(t._s(e.name))])])})),0)],1)},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("table",[a("thead",[a("tr",[a("th",[t._v("名称")]),a("th",[t._v("房间数")]),a("th",[t._v("实际使用面积(㎡)")]),a("th",[t._v("建筑总面积(㎡)")])])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"clearfix",staticStyle:{"text-align":"center",color:"#FFF","font-size":"18px"}},[a("div",{staticStyle:{width:"50%",float:"left"}},[t._v("用途面积占比")]),a("div",{staticStyle:{width:"50%",float:"left"}},[t._v("部门面积占比")])])}],s=(a("4160"),a("d81d"),a("26e9"),a("b0c0"),a("b680"),a("e25e"),a("159b"),a("be95")),i=a("4dc6"),r=a("5f81"),l=a("9f12"),c=a("53fe"),u=a("8b83"),d=a("c65a"),v=a("c03e"),h=a("9ab4"),f=a("60a3"),m=a("240a"),p=a("8d91"),_=a("7f1a"),g=a.n(_),b=a("c154"),C=function(t){function e(){var t;return Object(l["a"])(this,e),t=Object(u["a"])(this,Object(d["a"])(e).apply(this,arguments)),t.floors=[],t.countType="1",t.showDetail=!1,t.roomCount=0,t.usageCount=0,t.departmentCount=0,t.repairRoom=0,t.maintenanceCount=0,t.tableSource={usage:[],department:[]},t.roomDetail=[],t.roomLoading=!0,t.legend={usage:[],department:[]},t.total=0,t.tableCurrent=1,t.chartIdA="id"+parseInt(100*Math.random()+"1"),t.chartIdB="id"+parseInt(100*Math.random()+"1"),t.subscribe=t.$store.subscribe((function(e,a){"changeViewByCode"===e.type&&t.getCount()})),t}return Object(v["a"])(e,t),Object(c["a"])(e,[{key:"getCount",value:function(){var t=this,e=this.$store.state.modelValue;this.showDetail=!1,this.legend={usage:[],department:[]};var a=Object(m["a"])({url:"/space/room/",params:{floor:e,pagesize:1}});a.then((function(e){var a=e.data;t.roomCount=a.count})),Object(m["a"])({url:"/space/room/roominfo/",params:{floor:e}}).then((function(e){var o=e.data,n=o["用途"],s=o["部门"];t.departmentCount=s.length,t.usageCount=n.length,t.tableSource.department=s.map((function(t){return{name:t.department__name,count:t.id__count,areaUse:t.NetArea__sum,buildUse:t.GrossArea__sum}})),t.tableSource.usage=n.map((function(t){return{name:t.category__name,count:t.id__count,areaUse:t.NetArea__sum,buildUse:t.GrossArea__sum}})),a.then((function(){var e=t.roomCount;[t.chartA,t.chartB].forEach((function(a,o){void 0!==a&&(a.source(t.tableSource[["usage","department"][o]]),a.coord("theta"),a.tooltip({showTitle:!1}),a.legend({textStyle:{fill:"#FFF"}}),a.intervalStack().position("count").color("name").label("count",(function(t){return t/e<.05?null:{offset:-40,textStyle:{textAlign:"center",shadowBlur:2,shadowColor:"rgba(0, 0, 0, .45)",fill:"#fff"}}})).style({lineWidth:1,stroke:"#fff"}),a.render())}))}))})),Object(m["a"])({url:"/repair/rest/projecteventelement/unityinfo/",params:{t:"房间",floor:e}}).then((function(e){var a=e.data;a=a.data,t.maintenanceCount=a["维保"].length,t.repairRoom=a["维修"].length})),Object(m["a"])({url:"/user/department/",params:{Room__floor:e}}).then((function(e){var a=e.data;t.legend.department=a.map((function(t){return{name:t.name,color:t.color_code}}))})),Object(m["a"])({url:"/space/category/",params:{Room__floor:e}}).then((function(e){var a=e.data;t.legend.usage=a.map((function(t){return{name:t.name,color:t.color_code}}))})),this.pageChange(1)}},{key:"changeColor",value:function(t){this.$store.commit("changeColorType",["department","category"][t])}},{key:"pageChange",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.roomLoading=!0,this.tableCurrent=e,Object(m["a"])({url:"/space/room/",params:{floor:this.$store.state.modelValue,pagesize:6,page:e}}).then((function(e){var a=e.data;t.total=a.count,t.roomDetail=a.results,t.roomLoading=!1}))}},{key:"mounted",value:function(){var t=this;Object(m["a"])({url:"/space/floor/",params:{facility:1}}).then((function(e){var a=e.data;t.floors=a.reverse().map((function(t){return{name:t.name,id:t.id}}))})),this.chartA=new g.a.Chart({container:this.chartIdA,forceFit:!0,height:300}),this.chartB=new g.a.Chart({container:this.chartIdB,forceFit:!0,height:300}),this.getCount(),"room"!==this.$store.state.showType&&this.$store.commit("changeViewByCode",{type:"room",id:""}),this.$store.commit("changeWall",!1)}},{key:"beforeRouteLeave",value:function(t,e,a){this.subscribe(),this.$store.commit("changeWall",!0),a()}},{key:"tableValue",get:function(){return"0"===this.countType?this.tableSource.department:this.tableSource.usage}},{key:"unusedRoomCount",get:function(){var t=0;return this.tableSource.usage.forEach((function(e){t+=e.count})),this.roomCount-t}},{key:"currentLegend",get:function(){return"0"===this.countType?this.legend.department:this.legend.usage}}]),e}(f["c"]);C=h["a"]([Object(f["a"])({components:{Select:r["a"],Option:i["a"],FloorSelector:p["a"],Loading:b["a"],Page:s["a"]},filters:{getPresent:function(t,e){return 0===e?"0.00":(t/e*100).toFixed(2)}}})],C);var y=C,x=y,w=(a("e11b"),a("2877")),S=Object(w["a"])(x,o,n,!1,null,"b60fbf2c",null);e["default"]=S.exports},"5f81":function(t,e,a){"use strict";var o=a("4390"),n=(a("b374"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("li",{directives:[{name:"show",rawName:"v-show",value:!t.hidden,expression:"!hidden"}],class:[t.prefixCls+"-wrap"]},[a("div",{class:[t.prefixCls+"-title"]},[t._v(t._s(t.label))]),a("ul",[a("li",{ref:"options",class:[t.prefixCls]},[t._t("default")],2)])])}),s=[],i="ivu-select-group",r={name:"OptionGroup",props:{label:{type:String,default:""}},data:function(){return{prefixCls:i,hidden:!1}},methods:{queryChange:function(){var t=this;this.$nextTick((function(){for(var e=t.$refs.options.querySelectorAll(".ivu-select-item"),a=!1,o=0;o<e.length;o++)if("none"!==e[o].style.display){a=!0;break}t.hidden=!a}))}},mounted:function(){var t=this;this.$on("on-query-change",(function(){return t.queryChange(),!0}))}},l=r,c=a("2877"),u=Object(c["a"])(l,n,s,!1,null,null,null);u.exports,e["a"]=o["a"]},e11b:function(t,e,a){"use strict";var o=a("1458"),n=a.n(o);n.a}}]);
//# sourceMappingURL=chunk-325dc967.4ae6b860.js.map